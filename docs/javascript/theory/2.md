# 2. 垃圾回收

JS是使用垃圾回收的语言，也就是说执行环境负责在代码执行时管理内存。通过自动内存管理实现内存分配和闲置资源回收。

基本思路很简单： 确定那个变量不会再使用，然后释放它占用的内存。这个过程是周期性的，即垃圾回收程序没个一定时间就会自动运行。

垃圾回收主要有两种策略：标记清理和引用计数

## 标记清理

该策略是最常用的垃圾回收策略

当变量进入上下文，比如在函数内部声明一个变量时，和这个变量会被加上存在于上下文的标记。而在上下文中的变量，逻辑上讲，永远不应该释放他们的内存，因为只要上下文中的代码在运行就有可能用到它们。当变量离开上下文时，也会被加上离开上下文的标记。

实现方式：
1. 当变量进入上下文时，反转某一位；
2. 可以维护`在上下文中`和`不在上下文中`两个变量列表，可以把变量从一个列表转移到另一个列表。

::: tip
垃圾回收程序运行的时候，会标记内存中存储的所有变量，然后，它会将所有在上下文中的变量，以及被在上下文中的变量引用的变量的标记去掉。在此之后再被加上标记的变量就是待删除的了，原因是任何在上下文中的变量都访问不到他们了。随后垃圾回收程序做一次内存清理，销毁带标记的所有值并收回它们的内存。
:::

**标记过程的实现并不重要，关键是策略**

## 引用计数

基本思路：对每个值都记录它被引用的次数。声明变量并给它赋一个引用值时，这个值的引用数为1.如果同一个值又被赋给另一个变量，那么引用数加1。类似地，如果保存对该值引用的变量被其他值给覆盖了，那么引用数减一。当一个值的引用数为0时，就说明没办法再访问到这个值了，因此可以安全的收回其内存了。垃圾回收程序下次运行的时候就会释放引用数为0的值的内存。    

## 性能

1. 通过const和let声明提升性能

因为const和let都以块为作用域，所以相比var，使用这两个关键字可能会更早的让垃圾回收程序介入，尽早回收应该回收的内存。

2. 隐藏类或者删除操作

3. 内存泄漏


